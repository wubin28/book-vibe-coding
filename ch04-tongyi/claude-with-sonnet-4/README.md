# Excel部门应收款分析工具使用指南

## 项目简介

这是一个用于分析企业各部门间应收款项的Python工具。该工具能够读取Excel格式的部门对账表，提取应收款数据，并按金额从大到小排序，输出排名前三的部门对。

## 功能特点

- **智能部门识别**：自动识别任意格式的部门名称（如"智慧高速公路设计所"、"财务部"、"技术中心"等）
- **灵活数据处理**：提取并分析应收款数据，无需预设部门名称格式
- **排序和排名**：按金额降序排列所有应收款项
- **可配置输出**：支持自定义显示前N名部门对
- **调试模式**：提供详细的数据识别和处理过程信息
- **错误处理**：忽略空白单元格和无效数据
- **命令行支持**：支持命令行参数调用和批处理

## 系统要求

- Python 3.7 或更高版本
- 操作系统：Windows、macOS、Linux

## 安装和环境配置

### 1. 创建Python虚拟环境

#### Windows系统:
```cmd
# 创建虚拟环境
python -m venv receivable_env

# 激活虚拟环境
receivable_env\Scripts\activate

# 退出虚拟环境（使用完毕后）
deactivate
```

#### macOS/Linux系统:
```bash
# 创建虚拟环境
python3 -m venv receivable_env

# 激活虚拟环境
source receivable_env/bin/activate

# 退出虚拟环境（使用完毕后）
deactivate
```

### 2. 安装依赖包

激活虚拟环境后，安装所需的Python包：

```bash
pip install pandas openpyxl
```

或者使用requirements.txt文件（如果提供）：

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 基本使用

```bash
python analyze_receivables.py <Excel文件路径>
```

### 2. 增强版使用（推荐）

```bash
# 基本分析
python enhanced_analyze_receivables.py <Excel文件路径>

# 启用调试模式，查看详细处理过程
python enhanced_analyze_receivables.py -d <Excel文件路径>

# 显示前5名而不是前3名
python enhanced_analyze_receivables.py -n 5 <Excel文件路径>

# 组合使用调试模式和自定义排名数量
python enhanced_analyze_receivables.py -d -n 10 <Excel文件路径>
```

### 3. 使用示例

```bash
# 分析任意格式部门名称的Excel文件
python enhanced_analyze_receivables.py 公司对账表.xlsx

# 分析具体案例（带调试信息）
python enhanced_analyze_receivables.py -d 智慧交通部门对账.xlsx

# 显示前10名应收款项
python enhanced_analyze_receivables.py -n 10 部门财务数据.xlsx
```

### 预期输出格式

程序将输出以下格式的结果：

```
==================================================
所有应收款数据:
==================================================
 1. 智慧高速公路设计所应收技术研发中心：85000元
 2. 财务管理部应收智慧高速公路设计所：78000元
 3. 技术研发中心应收财务管理部：65000元
... (更多数据)

==================================================
排名前3的应收款:
==================================================
1. 智慧高速公路设计所应收技术研发中心：85000元
2. 财务管理部应收智慧高速公路设计所：78000元
3. 技术研发中心应收财务管理部：65000元
```

**调试模式输出示例：**
```
============================================================
调试信息 - 数据结构分析
============================================================
数据表形状: (15, 8)
列名: ['对账部门', '应收应付', '智慧高速公路设计所', '财务管理部', '技术研发中心', ...]

识别到的部门: ['智慧高速公路设计所', '财务管理部', '技术研发中心', ...]
第一列中识别到的部门: ['智慧高速公路设计所', '财务管理部', '技术研发中心', ...]

处理第 2 行: 智慧高速公路设计所 - 应收款
  -> 财务管理部: 25000 (类型: <class 'int'>)
    ✓ 记录: 智慧高速公路设计所 -> 财务管理部: 25000
...
```

## Excel文件格式要求

### 表格结构
- 第1行：标题行，包含"对账部门"、"应收应付"，以及各部门名称（如"部门01"、"部门02"等）
- 第1列：部门名称（如"部门01"、"部门02"等）
-  第2列：类型标识（"应收款"或"应付款"）
- 第3列及以后：各部门对应的金额数据

### 数据要求
- **部门名称**：支持任意格式的部门名称（如"智慧高速公路设计所"、"财务部"、"技术中心"等）
- **应收款标识**：第2列必须标注为"应收款"或"应收"
- **金额数据**：应为数字格式（整数或小数）
- **数据完整性**：空白单元格会被自动忽略
- **交叉数据**：相同部门交叉的数据会被忽略（如部门A对部门A）

## 文件结构

```
project/
├── analyze_receivables.py           # 基础版程序文件
├── enhanced_analyze_receivables.py  # 增强版程序文件（推荐）
├── README.md                       # 本说明文档
├── requirements.txt                # 依赖包列表
└── 示例文件/
    ├── 部门对账表脱敏样例.xlsx      # 标准格式示例
    └── 公司对账表.xlsx              # 自定义部门名称示例
```

## requirements.txt 内容

创建一个 `requirements.txt` 文件，内容如下：

```
pandas>=1.3.0
openpyxl>=3.0.0
```

## 常见问题

### Q1: 运行时提示"找不到模块"
**A1**: 请确保已激活虚拟环境并安装了所需依赖包：
```bash
pip install pandas openpyxl
```

### Q2: 读取Excel文件失败
**A2**: 请检查：
- 文件路径是否正确
- 文件是否为有效的Excel格式（.xlsx或.xls）
- 文件是否被其他程序占用

### Q3: 程序无法识别我的部门名称
**A3**: 
- 使用增强版程序：`python enhanced_analyze_receivables.py -d your_file.xlsx`
- 启用调试模式查看识别过程
- 确保部门名称不包含特殊关键词（如"合计"、"备注"等）
- 检查列标题是否为有效的部门名称

### Q4: 没有输出结果或结果为空
**A4**: 
- 使用调试模式：`python enhanced_analyze_receivables.py -d your_file.xlsx`
- 检查第二列是否正确标注为"应收款"或"应收"
- 确认数据为有效的数字格式
- 查看调试信息中的数据结构分析

### Q5: 如何修改显示的排名数量
**A5**: 使用 `-n` 参数：
```bash
python enhanced_analyze_receivables.py -n 10 your_file.xlsx  # 显示前10名
```

### Q6: 部门名称中包含特殊字符怎么办
**A6**: 增强版程序已支持包含特殊字符的部门名称，如：
- "智慧高速公路设计所"
- "财务管理部(总部)"  
- "技术研发中心-AI部门"

## 技术说明

- 使用 `pandas` 库读取和处理Excel数据
- 使用 `openpyxl` 库作为Excel文件的底层处理引擎
- 支持自动识别部门名称和数据结构
- 采用命令行参数方式提高程序的灵活性

## 开发环境

- Python 3.8+
- pandas 1.3.0+
- openpyxl 3.0.0+

## 许可证

本项目仅供学习和内部使用。

## 联系方式

如有问题或建议，请联系开发团队。