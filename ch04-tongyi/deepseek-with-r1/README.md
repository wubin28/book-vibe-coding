# 部门对账分析工具 - macOS运行指南

## 环境要求
- macOS系统
- Python 3.6+

## 设置步骤

### 1. 创建虚拟环境
```bash
python3 -m venv dept_venv
```

### 2. 激活虚拟环境
```bash
source dept_venv/bin/activate
```

### 3. 安装依赖库
```bash
pip install openpyxl
```

### 4. 运行分析脚本
```bash
# 使用默认文件名运行
python3 analysis.py

# 使用自定义文件名运行
python3 analysis.py "你的文件名.xlsx"
```

### 5. 退出虚拟环境
```bash
deactivate
```

## 功能说明
1. 自动识别Excel表格中的部门名称
2. 分析应收款数据并输出前三名
3. 自动处理以下特殊情况：
   - 忽略空白单元格
   - 忽略0值记录
   - 排除部门自身的对账记录
   - 适配任意部门名称格式

## 注意事项
- 确保Excel文件格式与样例一致：
  第一行：表头（对账部门、应收应付、部门列表）
  第一列：债权部门名称
  第二列：应收/应付标识
- 支持任意部门命名格式（如"部门01"或"智慧高速公路设计所"）
```

### 代码特点说明

1. **部门名称灵活性**：
   - 直接从表头读取目标部门名称（`target_departments`）
   - 从第一列读取债权部门名称
   - 不依赖特定命名格式，适应"部门0x"或"智慧高速公路设计所"等任意格式

2. **数据处理逻辑**：
   - 自动跳过空白单元格、0值记录和部门自身对账
   - 严格筛选"应收款"类型数据
   - 按金额降序排序并取前三名

3. **错误处理**：
   - 捕获并报告文件处理异常
   - 支持命令行参数指定文件名

4. **兼容性**：
   - 使用openpyxl处理现代Excel格式（.xlsx）
   - 兼容macOS文件路径

### 示例输出
```
1. 部门06应收部门07：83元
2. 部门05应收部门07：81元
3. 部门04应收部门07：79元
```